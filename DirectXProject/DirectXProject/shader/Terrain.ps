Texture2D shaderTexture : register(t0);
Texture2D detailTexture : register(t1);
SamplerState SampleType;

cbuffer LightBuffer
{
	float4 ambientColor;
	float4 diffuseColor;
	float3 lightDirection;
	float padding;
}

cbuffer TextureInfoBuffer
{
	bool useAlpha;
	float3 padding2;
}

struct PixelInputType
{
	float4 position : SV_POSITION;
	float4 tex : TEXCOORD0;
	float3 normal : NORMAL;
	float4 color : COLOR;
	float4 depthPosition: TEXCOORD1;	// 근접한 텍스처를 볼 때 선명하게 보이도록 픽셀의 깊이 변수 추가
};

float4 TerrainPixelShader(PixelInputType input) : SV_TARGET
{
	float4 textureColor;
	//float4 textureColor2;
	float3 lightDir;
	float lightIntensity;
	float4 color;
	//float4 alphaValue;
	//float4 blendColor;

	float depthValue;
	float detailBrightness;
	float4 detailColor;

	textureColor = shaderTexture.Sample(SampleType, input.tex.xy);

	// Z 픽셀 깊이를 균질 W 좌표로 나누어 픽셀의 깊이 값 세팅
	depthValue = input.depthPosition.z / input.depthPosition.w;

	// 깊이 값이 화면에 가까운지 체크하고, 근접하다면 디테일 텍스처 적용
	if(depthValue < 0.9f) {
		detailColor = detailTexture.Sample(SampleType, input.tex.zw);

		// 디테일 텍스처 밝기 설정
		detailBrightness = 1.8f;

		// 바닥 텍스처와 디테일 텍스처 결합
		textureColor = textureColor * detailColor * detailBrightness;
	}

	// 모든 픽셀에 대해 기본 출력 색상을 주변 광원 값으로 설정
	color = ambientColor;

	// 빛 방향은 실제와 반대방향
	lightDir = -lightDirection;

	// 현재 픽셀의 빛의 양 계산
	lightIntensity = saturate(dot(input.normal, lightDir));
	if(lightIntensity > 0.0f) {
		color += (diffuseColor * lightIntensity);
	}
	color = saturate(color);

	/*
	if(useAlpha) {
		textureColor1 = shaderTexture1.Sample(SampleType, input.tex);
		textureColor2 = shaderTexture2.Sample(SampleType, input.tex);

		// 알파 블렌딩 값 샘플링
		alphaValue = alphaMap.Sample(SampleType, input.tex);

		// 알파 값을 계산하여 블렌딩 색상 계산
		blendColor = (alphaValue * textureColor2) + ((1.0 - alphaValue) * textureColor1);
	} else {
		// 알파 블렌딩을 적용 안한다면 일반 텍스처로 색상 사용
		blendColor = shaderTexture1.Sample(SampleType, input.tex);
	}
	*/

	// 텍스처 픽셀과 빛을 곱하여 색상 계산
	color = color * textureColor;

	// 컬러 맵 값을 조합하여 최종 색상 계산
	color = saturate(color * input.color * 2.0f);

	return color;
}